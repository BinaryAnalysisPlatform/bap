#!/bin/sh

set -e

rm -f _oasis

FST=true
WITHOUT_BAP_LIBRARY=false

for i in "$@"; do
  if $FST; then
    set --
    FST=false
  fi

  case $i in
    --without-library)
      WITHOUT_BAP_LIBRARY=true
      ;;
    --*=*)
      ARG=${i%%=*}
      VAL=${i##*=}
      set -- "$@" "$ARG" "$VAL"
      ;;
    *)
      set -- "$@" "$i"
      ;;
  esac
done

if [ $WITHOUT_BAP_LIBRARY = "true" ]; then
    ocaml tools/cat.ml oasis/common oasis/src _oasis
else
    ocaml tools/cat.ml oasis/common oasis/bap oasis/src _oasis
fi

ocaml tools/cat.ml myocamlbuild.ml.in myocamlbuild.ml
ocaml tools/cat.ml setup.ml.in setup.ml
oasis -quiet setup
ocaml setup.ml -quiet -configure "$@"
